<div class="row">
    <div class="col-md-12 m-b-30">
        <!-- begin page title -->
        <div class="d-block d-lg-flex flex-nowrap align-items-center">
            <div class="page-title mr-4 pr-4 border-right">
                <h1>Quản lý mua sản phẩm tại cửa hàng</h1>
            </div>

            <div
                    class="ml-auto d-flex align-items-center secondary-menu text-center"
            ></div>
        </div>
        <!-- end page title -->
    </div>
</div>
<!-- end row -->
<!-- begin row -->
<div class="row">
    <div class="col-md-6">
        <div class="card card-statistics">
            <div class="card-header">
                <div class="card-heading">
                    <div class="row">
                        <div class="col-md-6 text-left">
                            <h4 class="card-title">Danh sách sản phẩm</h4>
                        </div>
                        <div class="col-md-6">
                            <form class="justify-content-end">
                                <div class="form-group">
                                    <input
                                            oninput="angular.element(this).scope().search(this.value)"
                                            type="text"
                                            class="form-control"
                                            placeholder="Tìm kiếm theo tên sản phẩm"
                                    />
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-body container">
                <div class="table-responsive">
                    <table class="table table-hover table-bordered">
                        <thead class="thead-light">
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Hình ảnh</th>
                            <th scope="col">Tên</th>
                            <th scope="col">Giá tiền</th>
                            <th scope="col">Ngày tạo</th>
                            <th scope="col">Có sẵn</th>
                            <th scope="col">Loại</th>
                            <th scope="col"></th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr ng-repeat="p in db.products | orderBy: p.id">
                            <th scope="row">{{$index+1}}</th>
                            <th>
                                <img
                                        ng-if="p.images"
                                        src="/images/product/{{imageProduct[p.id]}}"
                                        alt=""
                                        class="img-thumbnail"
                                />
                            </th>
                            <td>{{p.name}}</td>
                            <td>{{p.price}}</td>
                            <td>{{p.createDate | date: 'dd-MM-yyyy'}}</td>
                            <td>{{p.available?'Yes':'No'}}</td>
                            <td>{{p.brand.name}}</td>
                            <td class="text-right">
                                <button
                                        ng-disabled="!p.available"
                                        ng-click="add(p)"
                                        class="btn btn-primary"
                                >
                                    Thêm
                                </button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card card-statistics">
            <div class="card-header">
                <div class="card-heading">
                    <div class="row" style="padding: 5px">
                        <div class="col-md-2 text-left">
                            <h4 class="card-title">Danh sách sản phẩm mua</h4>
                        </div>
                        <div class="col-md-4">
                            <form class="justify-content-end">
                                <div class="form-group">
                                    <label for="select">Chọn bàn</label>
                                    <select
                                            id="select"
                                            oninput="angular.element(this).scope().setTable(this.value)"
                                    >
                                        <option value="0">Khách mang về</option>
                                        <option ng-repeat="table in tables" value="{{table.id}}">
                                            {{table.name}} - {{table.value==1?"Trống":"Không trống"}}
                                        </option>
                                    </select>
                                </div>
                            </form>
                        </div>
                        <div class="col-md-2">
                            <form class="justify-content-end">
                                <div class="form-group">
                                    <input
                                            oninput="angular.element(this).scope().setType()"
                                            type="checkbox"
                                            class="form-control"
                                            id="type"
                                            disabled="true"
                                    />
                                    <label for="type">Gộp hóa đơn</label>
                                </div>
                            </form>
                        </div>
                        <div class="col-md-2">
                            <form class="justify-content-end">
                                <div class="form-group">
                                    <input
                                            oninput="angular.element(this).scope().setStatus()"
                                            type="checkbox"
                                            class="form-control"
                                            id="status"
                                            checked="false"
                                            disabled="true"
                                    />
                                    <label for="status">Trả tiền</label>
                                </div>
                            </form>
                        </div>
                        <div class="col-md-2">
                            <form class="justify-content-end">
                                <div class="form-group">
                                    <button ng-click="refresh()" class="btn btn-success">
                                        Làm mới
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div
                    class="card-body container"
                    style="
          display: flex;
          flex-direction: column;
          justify-content: space-between;
        "
            >
                <div class="table-responsive">
                    <table class="table table-hover table-bordered">
                        <thead class="thead-light">
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Tên</th>
                            <th scope="col">Giá tiền</th>
                            <th scope="col">Số lượng</th>
                            <th scope="col">Tổng tiền</th>
                            <th scope="col"></th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr ng-repeat="od in orderDetails">
                            <th scope="row">{{$index+1}}</th>
                            <td>{{od.product.name}}</td>
                            <td>{{od.product.price}}</td>
                            <td>
                                <div class="group-quantity">
                                    <div
                                            ng-disabled="od.quantity==1"
                                            ng-click="decreaseQuantity(od.product)"
                                    >
                                        -
                                    </div>
                                    <div>{{od.quantity}}</div>
                                    <div ng-click="increaseQuantity(od.product)">+</div>
                                </div>
                            </td>
                            <td>{{od.price}}</td>
                            <td class="text-right">
                                <button ng-click="delete(od.product)" class="btn btn-dark">
                                    Xóa
                                </button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="text-right">
                    <div colspan="4" class="text-right font-weight-bold">
                        Thanh toán: {{total}}
                    </div>
                    <div class="text-right">
                        <button
                                ng-disabled="total == 0"
                                ng-click="submit(order.id,1)"
                                class="btn btn-primary"
                        >
                            Xác nhận đơn
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="dialog" ng-click="event.preventDefault()">
    <div>
        <p>
            Hóa đơn sẽ được gộp vào hóa đơn hiện có của bàn bạn đã chọn. Bạn chắc chăn
            không?
        </p>
        <div>
            <button id="yesButton" ng-click="createOrder()">Chắc</button>
            <button id="noButton" ng-click="cancelOrder()">Xem lại</button>
        </div>
    </div>
</div>
<div id="overlay"></div>

<style>
    #overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 999;
    }

    #dialog {
        width: 370px;
        height: 200px;
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        padding: 20px;
        background-color: #fff;
        border: 1px solid #ccc;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        z-index: 1000;
    }

    #dialog > div {
        height: 100%;
        width: 100%;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }

    #dialog > div > div {
        display: flex;
        justify-content: space-between;
    }

    #dialog p {
        text-align: center;
        font-weight: bold;
        font-size: 20px;
        color: black;
    }

    #dialog button {
        width: 100px;
        height: 40px;
        cursor: pointer;
    }

    #dialog button:first-child {
        background-color: blue;
        font-weight: bold;
        color: white;
    }

    #dialog button:last-child {
        background-color: red;
        font-weight: bold;
        color: white;
    }

    .container {
        max-height: calc(100vh - 260px);
        overflow-y: auto;
    }

    .card {
        max-height: calc(100vh - 230px);
        min-height: calc(100vh - 230px);
    }

    td {
        color: black;
    }

    th {
        text-align: center;
    }

    .group-quantity {
        display: flex;
        justify-content: center;
    }

    .group-quantity div {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 35px;
        height: 30px;
        font-size: 20px;
        font-weight: bold;
        background: rgb(255, 255, 255);
    }

    .group-quantity div:first-child {
        border-top-left-radius: 3px;
        border-bottom-left-radius: 3px;
        background: black;
        color: white;
        cursor: pointer;
    }

    .group-quantity div:last-child {
        border-top-right-radius: 3px;
        border-bottom-right-radius: 3px;
        background: black;
        color: white;
        cursor: pointer;
    }

    select {
        height: 35px;
        width: 150px;
        border-radius: 5px;
        cursor: pointer;
    }

    #status,
    #type {
        height: 35px;
        width: 35px;
        border-radius: 5px;
        cursor: pointer;
    }

    .form-group {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .form-group label {
        margin: 0 10px 0 10px;
    }

    .col-md-2 {
        padding: 0;
    }

    .app-main .container-fluid {
        padding: 70px 120px 0px 120px !important;
    }
</style>
